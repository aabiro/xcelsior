# ═══════════════════════════════════════════════════════════════════════
# Xcelsior v2.0.0 — Environment Variables
# Copy to .env and fill in your values.
# Variables marked [REQUIRED] must be set for production.
# ═══════════════════════════════════════════════════════════════════════

# ── Runtime Environment ───────────────────────────────────────────────
# dev = no token required, relaxed validation
# test = token required, test DB
# production = full security, rate limiting
XCELSIOR_ENV=dev

# ── API Authentication [REQUIRED in production] ──────────────────────
# Generate: python -c "import secrets; print(secrets.token_urlsafe(32))"
XCELSIOR_API_TOKEN=

# ── Rate Limiting ─────────────────────────────────────────────────────
XCELSIOR_RATE_LIMIT_REQUESTS=120
XCELSIOR_RATE_LIMIT_WINDOW_SEC=60

# ── Database Backend ──────────────────────────────────────────────────
# sqlite = local SQLite only (dev/single-node)
# postgres = PostgreSQL only (production)
# dual = dual-write to both (recommended for production migration)
XCELSIOR_DB_BACKEND=sqlite
XCELSIOR_DB_PATH=./xcelsior.db

# ── PostgreSQL [REQUIRED for production] ──────────────────────────────
XCELSIOR_POSTGRES_DSN=postgresql://xcelsior:change-me@localhost:5432/xcelsior
XCELSIOR_POSTGRES_DB=xcelsior
XCELSIOR_POSTGRES_USER=xcelsior
XCELSIOR_POSTGRES_PASSWORD=change-me
XCELSIOR_PG_POOL_SIZE=20
XCELSIOR_PG_MAX_OVERFLOW=10

# When DB_BACKEND=dual, which backend to read from:
XCELSIOR_DUAL_READ_FROM=sqlite

# ── Worker Agent [REQUIRED on GPU hosts] ──────────────────────────────
XCELSIOR_HOST_ID=
XCELSIOR_SCHEDULER_URL=http://localhost:8000
XCELSIOR_COST_PER_HOUR=0.50
XCELSIOR_HEARTBEAT_INTERVAL=10
XCELSIOR_POLL_INTERVAL=5
XCELSIOR_TELEMETRY_INTERVAL=5
XCELSIOR_MAX_FAILURES=30

# ── Container Security ───────────────────────────────────────────────
# Prefer gVisor (runsc) runtime for supported GPUs
XCELSIOR_PREFER_GVISOR=true

# Docker image cache limits (GB) on GPU workers
XCELSIOR_IMAGE_CACHE_MAX_GB=50
XCELSIOR_IMAGE_CACHE_EVICT_LOW_GB=40

# ── Mining Detection Thresholds ───────────────────────────────────────
XCELSIOR_MINING_GPU_UTIL=95
XCELSIOR_MINING_PCIE_TX_MB=5
XCELSIOR_MINING_DURATION_SEC=300
XCELSIOR_MINING_CHECK_INTERVAL=60

# ── Headscale / Tailscale Mesh ────────────────────────────────────────
XCELSIOR_TAILSCALE_ENABLED=false
XCELSIOR_TAILSCALE_AUTHKEY=
XCELSIOR_HEADSCALE_URL=

# ── SSH Key Management ───────────────────────────────────────────────
XCELSIOR_SSH_KEY_PATH=~/.ssh/xcelsior
XCELSIOR_SSH_USER=xcelsior

# ── Canadian Billing (CAD) ───────────────────────────────────────────
XCELSIOR_CAD_USD_RATE=0.73
XCELSIOR_PLATFORM_CUT=0.20
XCELSIOR_CANADA_ONLY=false

# ── Spot Pricing ─────────────────────────────────────────────────────
XCELSIOR_SPOT_SENSITIVITY=0.5
XCELSIOR_SPOT_THRESHOLD=0.8
XCELSIOR_SPOT_UPDATE_INTERVAL=600
XCELSIOR_PREEMPTION_GRACE_SEC=30

# ── Alerts: Email (SMTP) ─────────────────────────────────────────────
XCELSIOR_SMTP_HOST=
XCELSIOR_SMTP_PORT=587
XCELSIOR_SMTP_USER=
XCELSIOR_SMTP_PASS=
XCELSIOR_EMAIL_FROM=
XCELSIOR_EMAIL_TO=

# ── Alerts: Telegram ─────────────────────────────────────────────────
XCELSIOR_TG_TOKEN=
XCELSIOR_TG_CHAT_ID=

# ── Docker Image Builder ─────────────────────────────────────────────
XCELSIOR_REGISTRY=

# ── Auto-Scaling ─────────────────────────────────────────────────────
XCELSIOR_AUTOSCALE=false
XCELSIOR_AUTOSCALE_MAX=20
XCELSIOR_AUTOSCALE_PROVIDER=

# ── Artifact Storage — Primary (B2 / S3-compatible) ──────────────────
XCELSIOR_STORAGE_BACKEND=local
XCELSIOR_STORAGE_ENDPOINT_URL=
XCELSIOR_STORAGE_BUCKET=
XCELSIOR_STORAGE_REGION=
XCELSIOR_STORAGE_ACCESS_KEY_ID=
XCELSIOR_STORAGE_SECRET_ACCESS_KEY=
XCELSIOR_STORAGE_PRESIGN_EXPIRY=3600
XCELSIOR_STORAGE_MAX_UPLOAD_MB=500
XCELSIOR_STORAGE_RESIDENCY=CA

# ── Artifact Storage — Edge Cache (R2 / CDN) ─────────────────────────
XCELSIOR_CACHE_ENDPOINT_URL=
XCELSIOR_CACHE_BACKEND=local
XCELSIOR_CACHE_BUCKET=
XCELSIOR_CACHE_REGION=
XCELSIOR_CACHE_ACCESS_KEY_ID=
XCELSIOR_CACHE_SECRET_ACCESS_KEY=
XCELSIOR_CACHE_RESIDENCY=CA

# ── Stripe Connect (Provider Payouts) ────────────────────────────────
# Required for provider onboarding and marketplace payouts.
# Get keys at https://dashboard.stripe.com/apikeys
XCELSIOR_STRIPE_SECRET_KEY=
XCELSIOR_STRIPE_WEBHOOK_SECRET=
XCELSIOR_STRIPE_PLATFORM_CUT_PCT=15

# ── SLA Enforcement ──────────────────────────────────────────────────
# SQLite database for SLA downtime/violation tracking.
XCELSIOR_SLA_DB=xcelsior_sla.db
XCELSIOR_STRIPE_DB=xcelsior_stripe.db
